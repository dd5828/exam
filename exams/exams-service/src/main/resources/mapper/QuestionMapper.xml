<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.examsservice.mapper.QuestionMapper">


    <select id="pageQuery" resultType="com.exam.vo.QuestionVO">
        SELECT
        q.id, q.title, q.tags, q.question_type,
        q.total_answer_count, q.wrong_answer_count,
        q.create_time, q.update_time,
               c.type_name as categoryName,u.name as createUser ,u2.name as updateUser
        FROM questions q
        LEFT JOIN category c ON c.id = q.category_id
        left join user u on q.create_user_id=u.id
        left join user u2 on q.update_user_id=u2.id
        <where>
            <if test="title!=null">
                and q.title like concat('%',#{title},'%')
            </if>
            <if test="categoryId!=null">
                and q.category_id=#{categoryId}
            </if>
            <if test="questionType!=null">
                and q.question_type like concat('%',#{questionType},'%')
            </if>
        </where>
    </select>


    <!-- 定义resultMap，明确列与VO字段的映射 -->
    <!-- 必须确保resultMap的id唯一，且与select标签的resultMap属性一致 -->
    <resultMap id="QuestionVOMap" type="com.exam.vo.QuestionVO">
        <!-- 主键映射 -->
        <id column="id" property="id"/>
        <!-- 题目基本信息 -->
        <result column="title" property="title"/>
        <result column="tags" property="tags"/>
        <result column="question_type" property="questionType"/>
        <result column="total_answer_count" property="totalAnswerCount"/>
        <result column="wrong_answer_count" property="wrongAnswerCount"/>
        <!-- 时间字段（LocalDateTime），对应SQL的create_time/update_time -->
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <!-- 关联表字段 -->
        <result column="categoryName" property="categoryName"/>
        <result column="createUser" property="createUser"/>
        <result column="updateUser" property="updateUser"/>
    </resultMap>

    <!-- 查询语句使用resultMap而非resultType -->
    <select id="getById" resultMap="QuestionVOMap" parameterType="long">
        SELECT
            q.id,
            q.title,
            q.tags,
            q.question_type,
            q.total_answer_count,
            q.wrong_answer_count,
            q.create_time,
            q.update_time,
            c.type_name as categoryName,
            u.name as createUser,
            u2.name as updateUser
        FROM questions q
                 LEFT JOIN category c ON c.id = q.category_id
                 LEFT JOIN user u ON q.create_user_id = u.id
                 LEFT JOIN user u2 ON q.update_user_id = u2.id
        WHERE q.id = #{id}
    </select>


    <select id="getBatch" resultType="com.exam.vo.questionTypeVo">
        SELECT question_type,COUNT(question_type)AS sum_Question FROM questions
        GROUP BY question_type
    </select>

</mapper>
